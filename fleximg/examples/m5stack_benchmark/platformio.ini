; PlatformIO Project Configuration File
; fleximg M5Stack Format Matrix Benchmark
;
; Build targets:
;   pio run -e native            # macOS native build (SDL window)
;   pio run -e m5core2           # M5Stack Core2 (16bit Premul)
;   pio run -e m5core2_straight  # M5Stack Core2 (8bit Straight)
;   pio run -e m5cores3          # M5Stack CoreS3 (16bit Premul)
;   pio run -e m5cores3_straight # M5Stack CoreS3 (8bit Straight)

[platformio]
default_envs = native

; =============================================================================
; 共通設定
; =============================================================================
[env]
lib_deps =
    m5stack/M5Unified
build_flags =
    -DFLEXIMG_NAMESPACE=fleximg
    -DFLEXIMG_DEBUG
    -Wall
    -Wextra
    -I../../src

; ESP32系ボード共通設定
[esp32_common]
platform = espressif32
framework = arduino
board_build.f_cpu = 240000000L
board_build.f_flash = 80000000L
board_build.flash_mode = qio
monitor_filters = esp32_exception_decoder
monitor_speed = 115200
build_flags =
    -Os
    ${env.build_flags}
    -std=gnu++17
    -DBOARD_HAS_PSRAM=0
build_unflags =
    -std=gnu++11
    -DBOARD_HAS_PSRAM
lib_deps =
    ${env.lib_deps}

; =============================================================================
; Native (macOS/Linux/Windows with SDL)
; =============================================================================
[env:native]
platform = native
build_type = debug
build_flags =
    -O0 -xc++ -std=c++14 -lSDL2 -arch arm64
    -I"/usr/local/include/SDL2"
    -L"/usr/local/lib"
    -I"${sysenv.HOMEBREW_PREFIX}/include/SDL2"
    -L"${sysenv.HOMEBREW_PREFIX}/lib"
    -DFLEXIMG_NAMESPACE=fleximg
    -DFLEXIMG_DEBUG
    -I../../src
lib_deps =
    m5stack/M5Unified

; =============================================================================
; M5Stack Core2
; =============================================================================
[env:m5core2]
extends = esp32_common
board = m5stack-core2
build_flags =
    ${esp32_common.build_flags}
    -DARDUINO_M5STACK_CORE2

[env:m5core2_straight]
extends = esp32_common
board = m5stack-core2
build_flags =
    ${esp32_common.build_flags}
    -DARDUINO_M5STACK_CORE2
    -DFLEXIMG_COMPOSITE_USE_STRAIGHT

; =============================================================================
; M5Stack CoreS3
; =============================================================================
[env:m5cores3]
extends = esp32_common
board = m5stack-cores3
build_flags =
    ${esp32_common.build_flags}
    -DARDUINO_M5STACK_CORES3

[env:m5cores3_straight]
extends = esp32_common
board = m5stack-cores3
build_flags =
    ${esp32_common.build_flags}
    -DARDUINO_M5STACK_CORES3
    -DFLEXIMG_COMPOSITE_USE_STRAIGHT
