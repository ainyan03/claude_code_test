# TODO リスト

最終更新: 2026-01-05

## ✅ 完了済み（このセッションで達成）

### コア実装
- [x] レイヤーベースシステムからノードグラフエディタへの完全移行
- [x] 画像ライブラリの実装
- [x] 5種類のノードタイプ（画像、アフィン変換、合成、フィルタ、出力）
- [x] C++ NodeGraphEvaluator の実装（トポロジカルソート、メモ化）
- [x] ノードドラッグ&ドロップ機能
- [x] ワイヤー接続UI
- [x] コンテキストメニュー（右クリック）
- [x] パラメータ/行列表示モード切り替え

### UI/UX改善（12コミット）
- [x] 動的ノード高さ調整
- [x] ポート位置のラグ修正
- [x] ポートヒットエリアの透明化
- [x] キャンバスリサイズ対応
- [x] スライダーラベル配置改善
- [x] リアルタイム接続線更新

### ドキュメント整備
- [x] README.md の全面書き換え（ノードグラフアーキテクチャ）
- [x] QUICKSTART.md の更新
- [x] GITHUB_PAGES_SETUP.md の更新
- [x] CHANGELOG.md の作成
- [x] PROJECT_STATUS.md の作成
- [x] BRANCH_STRATEGY.md の作成
- [x] TODO.md の作成（このファイル）

### インフラ・運用
- [x] GitHub Actions自動デプロイ設定
- [x] ハイブリッドブランチ戦略の確立
- [x] mainブランチの作成
- [x] セッション継続性の確保

### クリーンアップ
- [x] 旧レイヤーシステムコードの完全削除（461行）
- [x] 不要なブランチの削除
- [x] **Phase 6: WebAssemblyバインディング整理**（2026-01-04）
  - [x] app.jsからImageProcessor依存を削除
  - [x] ImageProcessorWrapperを完全削除（約410行削減）
  - [x] NodeGraphEvaluator専用アーキテクチャに移行

### UI/UX大幅改善（2026-01-05）
- [x] **左サイドバーメニュー**: 画像ライブラリと出力設定を統合
  - [x] トグルボタンで開閉（ESCキー、オーバーレイクリック対応）
  - [x] レスポンシブデザイン（PC: コンテンツ操作可能、モバイル: オーバーレイ）
- [x] **リサイズ可能なスプリッター**: ノードグラフとプレビュー間
  - [x] マウス・タッチ両対応
  - [x] 各セクション独立スクロール
- [x] **プレビューエリア改善**
  - [x] スクロールバー常時表示
  - [x] スクロール位置自動中央調整
  - [x] 表示倍率スライダー（1x〜5x）
- [x] **ヘッダーコンパクト化**: 横並びレイアウト、コンテンツ領域拡大

### 合成ノード簡素化（2026-01-05）
- [x] 合成ノードからアフィンパラメータを削除
- [x] 詳細ボタンと編集パネルを削除
- [x] C++側のcompositeTransformフィールドと処理を削除
- [x] アフィン変換は専用ノードで行う設計に統一

---

## 🎯 機能拡張（優先度順）

### 高優先度

#### A1. ノードグラフの保存/読み込み機能
**概要**: ノードグラフをJSON形式で保存し、後で読み込める機能

**実装内容**:
- [ ] ノードグラフをJSONシリアライズする関数
- [ ] JSONからノードグラフをデシリアライズする関数
- [ ] 「保存」ボタンの追加（JSONファイルダウンロード）
- [ ] 「読み込み」ボタンの追加（JSONファイルアップロード）
- [ ] LocalStorageへの自動保存（オプション）
- [ ] 複数のプリセット管理

**想定効果**:
- ユーザーが作成したパイプラインを再利用可能
- サンプルプリセットを提供可能
- 作業の中断・再開が容易

**難易度**: 中

---

#### A2. 追加ノードタイプ: ぼかしフィルタ
**概要**: ガウシアンぼかしを適用するノード

**実装内容**:
- [ ] C++側: ガウシアンぼかし処理の実装
- [ ] Emscriptenバインディングの追加
- [ ] JavaScript側: ぼかしノードUIの追加
- [ ] パラメータ: ぼかし半径（0-50px）

**想定効果**:
- 背景ぼかし効果
- ソフトフォーカス効果
- より豊かな画像処理パイプライン

**難易度**: 中

---

#### A3. 追加ノードタイプ: トリミング/クロップ
**概要**: 画像の一部を切り出すノード

**実装内容**:
- [ ] C++側: 矩形トリミング処理
- [ ] パラメータ: X, Y, 幅, 高さ
- [ ] JavaScript側: トリミングノードUI
- [ ] オプション: ビジュアルなトリミング領域選択UI

**想定効果**:
- 画像の不要部分を削除
- 構図の調整
- 特定領域のみを処理

**難易度**: 中

---

### 中優先度

#### B1. パフォーマンス最適化: 16bit直接処理
**概要**: フィルタ処理で8bit変換を経由せず、16bit直接処理に最適化

**背景**:
現在、`src/image_transform.cpp:667` で TODO コメントあり
```cpp
// TODO: 将来的には16bit直接処理に最適化
```

**実装内容**:
- [ ] 16bit整数での明るさ・コントラスト調整実装
- [ ] 8bit変換ステップの削除
- [ ] パフォーマンステスト（処理時間計測）

**想定効果**:
- フィルタ処理の高速化
- 精度向上（丸め誤差の削減）

**難易度**: 低〜中

---

#### B2. 追加ノードタイプ: 色調補正
**概要**: HSV/HSL色空間での色調整ノード

**実装内容**:
- [ ] C++側: RGB↔HSV変換
- [ ] パラメータ: 色相（Hue）、彩度（Saturation）、明度（Value）
- [ ] JavaScript側: 色調補正ノードUI

**想定効果**:
- 色味の調整
- セピア調、モノクロ変換
- カラーグレーディング

**難易度**: 中

---

#### B3. ノードグラフのプレビュー機能強化
**概要**: 各ノードの中間出力をプレビュー表示

**実装内容**:
- [ ] ノードごとの小さなサムネイル表示
- [ ] ホバー時に拡大プレビュー
- [ ] デバッグモード（各ステップの確認）

**想定効果**:
- パイプラインのデバッグが容易
- 各ノードの効果を視覚的に確認
- 学習用途に最適

**難易度**: 中〜高

---

### 低優先度

#### C1. ユニットテスト
**概要**: C++ NodeGraphEvaluator のテストケース追加

**実装内容**:
- [ ] テストフレームワークの導入（Google Test等）
- [ ] NodeGraphEvaluator のテスト
  - [ ] トポロジカルソート
  - [ ] 循環依存の検出
  - [ ] メモ化の動作確認
- [ ] 各ノードタイプの単体テスト
- [ ] CI/CDでの自動テスト実行

**想定効果**:
- コード品質の向上
- リファクタリングの安全性向上
- バグの早期発見

**難易度**: 中

---

#### C2. エラーハンドリング強化
**概要**: ユーザーフレンドリーなエラーメッセージ

**実装内容**:
- [ ] ノードグラフの循環依存検出とエラー表示
- [ ] 画像読み込みエラーの詳細表示
- [ ] WebAssemblyロードエラーのフォールバック
- [ ] トースト通知でのエラー表示

**想定効果**:
- ユーザビリティ向上
- デバッグの容易化

**難易度**: 低〜中

---

#### C3. モバイルUI最適化
**概要**: スマートフォンでの操作性向上

**実装内容**:
- [ ] タッチジェスチャーの改善（ピンチズーム等）
- [ ] ノードサイズの動的調整（画面サイズに応じて）
- [ ] モバイル専用レイアウト
- [ ] スワイプ操作のサポート

**想定効果**:
- モバイルでの使いやすさ向上
- より広いユーザー層へのリーチ

**難易度**: 中

---

#### C4. アンドゥ/リドゥ機能
**概要**: 操作の取り消し・やり直し

**実装内容**:
- [ ] コマンドパターンの実装
- [ ] 履歴スタックの管理
- [ ] Ctrl+Z / Ctrl+Shift+Z のキーバインド
- [ ] 履歴の最大数制限

**想定効果**:
- ユーザビリティ大幅向上
- 試行錯誤が容易に

**難易度**: 中〜高

---

#### C5. マルチ出力ノード
**概要**: 複数の出力ノードで異なる結果を同時プレビュー

**実装内容**:
- [ ] 複数の出力ノードを許可
- [ ] 各出力ノードに個別のキャンバス
- [ ] サイドバイサイド表示

**想定効果**:
- 同じパイプラインで複数のバリエーション作成
- A/Bテスト的な使い方

**難易度**: 中

---

## 🧪 実験的アイデア

### D1. WebGPU対応
**概要**: GPU計算による超高速化

**実装内容**:
- [ ] WebGPU APIの調査
- [ ] シェーダーでの画像処理実装
- [ ] WebAssemblyとのパフォーマンス比較

**難易度**: 高

---

### D2. AIフィルタノード
**概要**: TensorFlow.js等を使用した機械学習ベースのフィルタ

**実装内容**:
- [ ] スタイル転送（Style Transfer）
- [ ] 超解像（Super Resolution）
- [ ] 物体検出とマスク

**難易度**: 高

---

### D3. コラボレーション機能
**概要**: リアルタイムでの共同編集

**実装内容**:
- [ ] WebSocketサーバーの構築
- [ ] ノードグラフの同期
- [ ] ユーザーカーソルの表示

**難易度**: 非常に高

---

## 🔧 コード品質・バグ修正

最終更新: 2026-01-04

### ✅ 修正済み（2026-01-04）
- [x] `app.js`: キャンバスサイズのNaN検証を追加
- [x] `app.js`: 未使用パラメータ `unusedNodeHeight` を削除
- [x] `app.js`: 未使用変数 `portRadius` を削除（getPortPosition）
- [x] `app.js`: 未使用パラメータ `e` を削除（mouseup handler）
- [x] `app.js`: ループ内のDOM取得を最適化（renderImageLibrary）
- [x] `app.js`: innerHTML を DOM API に置き換え（XSS対策）
- [x] `bindings.cpp`: mergeImages の境界チェックを追加
- [x] `bindings.cpp`: viewPortFromJSImage の入力検証追加（Q2）
- [x] `bindings.cpp`: size_t を使用してオーバーフロー防止（Q8）
- [x] `bindings.cpp`: reserve() でダングリングポインタ防止（Q1）
- [x] `app.js`: appInitialized フラグでイベントリスナー重複登録防止（Q5）
- [x] `node_graph.h`: GraphNode フィールド初期化確認済み（Q4 - 問題なし）
- [x] `viewport.cpp`: deepCopy にストライド検証アサート追加（Q7）
- [x] `bindings.cpp`: Q3, Q6 - ImageProcessorWrapper削除により解消（Phase 6で削除）
- [x] `app.js`: processor.setCanvasSize() バグ修正（Phase 6で削除）

### ✅ 修正済み（2026-01-04 追加）

- [x] **Q6. 後方互換性コード削除**: 旧形式（layerId, alpha1/alpha2）を完全削除（PR #16）
  - bindings.cpp: 旧形式パースコード削除
  - node_graph.h: 旧フィールド6個、layerPremulCache削除
  - node_graph.cpp: getLayerPremultiplied関数、旧形式処理削除
  - 約143行削減

---

## 📝 メンテナンスタスク

### M1. 定期的な更新
- [ ] Emscriptenのバージョン更新
- [ ] GitHub Actionsのアクション最新化
- [ ] 依存関係のセキュリティアップデート

### M2. ドキュメントメンテナンス
- [ ] スクリーンショットの追加
- [ ] チュートリアル動画の作成
- [ ] FAQ セクションの追加

---

## 🎯 次のセッションで優先すべきタスク

**推奨順序**:
1. **A1. ノードグラフの保存/読み込み** - ユーザー価値が非常に高い
2. **A2. ぼかしフィルタ** - 需要が高く、実装が比較的容易
3. **B1. 16bit直接処理** - 既存のTODOコメントを解決
4. **C2. エラーハンドリング** - ユーザビリティ向上

---

## 📌 注意事項

- このTODOリストは優先度の参考です。ユーザーの要望に応じて柔軟に変更してください
- 新機能追加前に、必ず `main` ブランチから新しい `claude/[feature]-[session-id]` ブランチを作成
- 実装後は PROJECT_STATUS.md と CHANGELOG.md の更新を忘れずに
- 各タスクは小さなコミットに分割し、プッシュすることで自動デプロイを活用

---

## 🔗 関連ドキュメント

- [PROJECT_STATUS.md](PROJECT_STATUS.md): 現在の状態
- [CHANGELOG.md](CHANGELOG.md): 変更履歴
- [BRANCH_STRATEGY.md](BRANCH_STRATEGY.md): ブランチ運用方針
